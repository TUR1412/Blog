@tailwind base;
@tailwind components;
@tailwind utilities;

@keyframes xuantian-shimmer {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes xuantian-edge-flow {
  0% {
    stroke-dashoffset: 0;
  }
  100% {
    stroke-dashoffset: -12;
  }
}

:root {
  --bg: 231 38% 7%;
  --fg: 210 40% 98%;
  --muted: 225 22% 70%;
  --card: 230 35% 10%;
  --border: 225 18% 20%;
  --ring: 196 94% 54%;
  --accent: 196 94% 54%;
  --accent2: 284 88% 68%;
  --good: 145 70% 44%;
  --warn: 42 92% 55%;
  --bad: 0 78% 58%;

  --radius: 18px;
  --glass: rgba(255, 255, 255, 0.08);
  --glass2: rgba(255, 255, 255, 0.04);
  --stroke: rgba(255, 255, 255, 0.10);
}

html.theme-light {
  --bg: 46 86% 96%;
  --fg: 231 30% 12%;
  --muted: 230 14% 38%;
  --card: 0 0% 100%;
  --border: 230 20% 86%;
  --ring: 196 94% 40%;
  --accent: 196 94% 40%;
  --accent2: 284 70% 48%;
  --good: 145 58% 34%;
  --warn: 42 88% 46%;
  --bad: 0 74% 44%;

  --glass: rgba(0, 0, 0, 0.04);
  --glass2: rgba(0, 0, 0, 0.02);
  --stroke: rgba(0, 0, 0, 0.08);
}

@layer base {
  html {
    height: 100%;
    color-scheme: dark;
    text-rendering: geometricPrecision;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  html.theme-light {
    color-scheme: light;
  }

  body {
    min-height: 100%;
    margin: 0;
    background: hsl(var(--bg));
    color: hsl(var(--fg));
    font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
      'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Noto Sans CJK SC',
      'WenQuanYi Micro Hei', Arial, sans-serif;
    overflow-x: hidden;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  ::selection {
    background: hsl(var(--accent) / 0.28);
  }

  html.reading-immersive header {
    opacity: 0;
    pointer-events: none;
    transform: translateY(-12px);
    transition:
      opacity 180ms ease,
      transform 220ms ease;
  }

  html.reading-immersive footer {
    display: none;
  }

  html.reading-immersive main#content {
    padding-top: 1.25rem;
  }
}

@layer components {
  .glass {
    background: linear-gradient(180deg, var(--glass), var(--glass2));
    border: 1px solid var(--stroke);
    box-shadow: theme('boxShadow.glass');
    backdrop-filter: blur(theme('backdropBlur.lg'));
  }

  .focus-ring {
    outline: none;
  }

  .focus-ring:focus-visible {
    box-shadow: 0 0 0 4px hsl(var(--ring) / 0.25);
  }

  .tap {
    transition:
      scale 140ms cubic-bezier(0.2, 0.8, 0.2, 1),
      filter 140ms cubic-bezier(0.2, 0.8, 0.2, 1),
      background-color 180ms ease,
      border-color 180ms ease,
      box-shadow 180ms ease;
  }

  .tap:hover {
    will-change: transform, filter;
    scale: 1.015;
    filter: brightness(1.06);
  }

  .tap:active {
    will-change: transform, filter;
    scale: 0.985;
  }

  .xuantian-edge-flow {
    animation: xuantian-edge-flow 1.25s linear infinite;
  }

  /* 经卷观：首段落款（“开卷一字起势”） */
  .xuantian-md > p:first-of-type {
    position: relative;
  }

  .xuantian-md > p:first-of-type::first-letter {
    float: left;
    font-size: 2.75em;
    line-height: 0.92;
    padding-right: 0.12em;
    padding-top: 0.04em;
    font-weight: 700;
    color: hsl(var(--fg) / 0.98);
    text-shadow: 0 18px 60px rgba(0, 0, 0, 0.35);
  }

  html.theme-light .xuantian-md > p:first-of-type::first-letter {
    text-shadow: 0 18px 50px rgba(0, 0, 0, 0.14);
  }

  /* 经卷观：检索命中（札记/批注馆/洞府批注） */
  .xuantian-md mark[data-x-hit] {
    padding: 0.02em 0.14em;
    border-radius: 0.45em;
    border: 1px solid hsl(var(--border) / 0.6);
    background: linear-gradient(90deg, hsl(var(--accent) / 0.18), hsl(var(--accent2) / 0.14));
    color: hsl(var(--fg) / 0.96);
    box-decoration-break: clone;
    -webkit-box-decoration-break: clone;
    transition:
      background-color 180ms ease,
      border-color 180ms ease,
      box-shadow 180ms ease;
  }

  .xuantian-md mark[data-x-hit][data-x-active='1'] {
    border-color: hsl(var(--accent) / 0.36);
    background: linear-gradient(90deg, hsl(var(--accent) / 0.32), hsl(var(--accent2) / 0.26));
    box-shadow:
      0 0 0 4px hsl(var(--accent) / 0.10),
      0 14px 48px rgba(0, 0, 0, 0.28);
  }

  html.theme-light .xuantian-md mark[data-x-hit] {
    border-color: hsl(var(--border) / 0.75);
    background: linear-gradient(90deg, hsl(var(--accent) / 0.18), hsl(var(--accent2) / 0.14));
    color: hsl(var(--fg) / 0.95);
  }

  html.theme-light .xuantian-md mark[data-x-hit][data-x-active='1'] {
    border-color: hsl(var(--accent2) / 0.38);
    box-shadow:
      0 0 0 4px hsl(var(--accent2) / 0.10),
      0 12px 40px rgba(0, 0, 0, 0.12);
  }

  /* 经卷观：锚点跳转“落印”提示（ToC/# 内链） */
  .xuantian-md [data-x-flash] {
    outline: 1px solid hsl(var(--accent2) / 0.18);
    background: hsl(var(--accent2) / 0.06);
    border-radius: 0.9rem;
    box-shadow: 0 0 0 4px hsl(var(--accent2) / 0.08);
    transition:
      outline-color 180ms ease,
      background-color 180ms ease,
      box-shadow 180ms ease;
  }

  html.theme-light .xuantian-md [data-x-flash] {
    outline-color: hsl(var(--accent2) / 0.26);
    background: hsl(var(--accent2) / 0.08);
    box-shadow: 0 0 0 4px hsl(var(--accent2) / 0.10);
  }
}
